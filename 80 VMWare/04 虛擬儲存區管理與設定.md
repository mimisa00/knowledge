## 前言
1. VMware 基於存儲策略的存儲管理( SPBM )：
> <img width="1029" height="389" alt="image" src="https://github.com/user-attachments/assets/df1fa3be-89fd-425d-ae79-f34a63b507dd" />

> a. 伺服器的儲存空間可概略區分為以下三類：
>>  DAS (Direct Attached Storage)：SATA、SAS…等
>> 
>> SAN (Storage Area Network )：FC-SW、FCoE、iSCSI…等
>> 
>> NAS ( Network Attached Storage )：NFS、SMB…等
>
> b. DAS即為本機硬碟；SAN及NAS為共享儲存，可供多人連線存儲。ESXi安裝時即安裝於DAS上，而建立之VM，可存放於任一類型的儲存區。
> 
> c. NAS屬於檔案型式儲存，而DAS及SAN屬Block型式儲存。也就是掛載DAS及SAN後，還需格式化成檔案系統始可存儲資料；
> NAS則是將已完成格式化的檔案系統，以NFS、SMB等通訊協定共享的儲存區。
>
> d. vSphere支援的儲存區方案有VMFS、NFS、vSAN及vVOL：
>> i. VMFS：此為VMware使用的檔案系統格式，於vCenter新增VMFS的儲存區時，會搜尋ESXi主機可存取的DAS或SAN，再將其格式化為VMFS。
>> 
>> ii. NFS：vSphere支援NFS 3及4.1版本通訊協定掛載NFS Server分享的儲存區。掛載相同的NFS儲存區時切勿使用不同版本的協定，
>> 因使用者編輯檔案時，系統會鎖定該檔案禁止他人修改，避免造成資料錯亂。但NFS 3的檔案鎖定機制效能很差，故VMware另行設計一套鎖定機制，但到了NFS 4版本時，VMware將此鎖定機制回歸於NFS Server去處理，故當使用不同版本協定存取同一檔案時，NFS3由VMware鎖定， 而NFS4卻由NFS Server處理，不會去檢查檔案鎖定的狀態，致檔案同時間可能會有多個使用者修改，造成錯誤。
>> 
>> iii. vSAN：將叢集內ESXi所掛載的DAS儲存資源，整合成單一儲存集區，具有磁碟熱備援機制，以確保儲存檔案的持續可用性。
>> 
>> iv. vVOL：是一個針對外部儲存系統（SAN/NAS）所提供的整合式管理架構，可讓多部不同廠牌的外接儲存設備，架構成一個儲存容器供ESXi使用。

2. 儲存區層級：
> <img width="654" height="334" alt="image" src="https://github.com/user-attachments/assets/4182b2e9-63b2-459c-a7d3-d57ee5e463ee" />
>
> 儲存區可概略區分以下三個層級：
>> a. 裝置：系統掛載新的儲存裝置，類似伺服器加裝了新的硬碟一樣，以iSCSI、FC-SW及FCoE等介面共享裝置，可供多個系統同時掛載。
>> 
>> b. 檔案系統：裝置掛載後需要再格式化始變為可存放檔案的儲存空間，VMware採用VMFS的檔案系統，可供多台裝置掛載存取；Windows、Linux
                  習慣使用的檔案格式NTFS、EXT4，同一時間僅能1個系統掛載。
>>
>> c. 檔案：大部份的檔案系統，均設有檔案的鎖定機制，以避免多人同時編輯同一檔案，造成資料的異常，Lustre FS是少數支援多人共同編輯的檔案系統。

## 儲存區新增步驟
1. 新增NFS儲存區
> a. 前一章於vCenter上針對ESXi新增vSwitch1，並指派VMkernel對映之IP。新增NFS儲存區時，要確保網路已完成設定，並可與NFS Server連線，
這裡採用前章VDS的網路架構連接NFS儲存區。
> 
> b. 進入vSphere Client，導覽窗格切換至「儲存區」頁籤，並於「資料中心」物件右鍵選單，選至「儲存區」->「新增資料存放區」。
> 
> c. 彈出視窗後，類型選「NFS」，下一頁選NFS 3的版本，NFS版本要依NFS Server分享儲存區的版本類型設定，接著下一頁進入名稱和組態設定。
> 
> d. 名稱組態內容如下：
> 
> > i. 名稱：INT10_SAS_ERP
> > 此格可隨意填寫，這裡使用分享的資料夾檔名為其名稱。
> > 
> > ii. 資料夾：/INT10_SAS_ERP
> > 此為NFS Server分享資料夾之路徑
> >
> > iii. 伺服器：10.213.10.240
> > 這邊輸入NFS Server的IP，亦可輸入FQDN，但若輸入FQDN，vCenter Server查詢之DNS需能解析FQDN。
> > 
> e. 接續「主機可存取性」會列出目前可存取此NFS Server分享資料夾之ESXi主機，通常都是讓所有可存取之主機均可使用此儲存區。
> 
> f. 之後確認設定即完成NFS儲存區新增。

2. 新增iSCSI儲存區
<img width="944" height="382" alt="image" src="https://github.com/user-attachments/assets/0a434830-d9f7-4150-90d7-72bfb72fe0de" />

> a. 新增iSCSI儲存區前，需先針對ESXi新增儲存裝置介面卡，並從介面卡設定iSCSI伺服器及連接埠，搜索伺服器分享之儲存區再行掛載。
> 
> b. 這裡使用的iSCSI Server，並無限制可掛載儲存區Client端的IP、帳密及IQN，只要知道伺服器IP及Port即可掛載。
>
> c. 於vSphere Client導覽區切至「主機和叢集」頁籤，點擊欲新增iSCSI儲存區之主機物件，右邊畫面切至「設定」頁籤 ，將下方的「儲存區」展開，
> 點擊「儲存裝置介面卡」。
>
> d. 右邊「儲存裝置介面卡」內若無iSCSI軟體介面卡，可點擊「新增軟體介面卡」，確定後即完成iSCSI軟體介面卡新增，識別碼欄位顯示之資訊，即為
> 此ESXi iSCSI的IQN。因目前的iSCSI Server無任何限制，故無需登錄此IQN，但若iSCSI Server有限制時，需將此IQN加入iSCSI Server Targets的設定。
>
> e. 點選iSCSI介面卡，下方會顯示此介面卡的相關設定。切至「網路連接埠繫結」，新增ESXi連接iSCSI使用之VMKernel，這裡請選NFS_Storage連接埠群組後確定。
>
> f. 切至「動態探索」頁籤，新增iSCSI伺服器，彈出之視窗輸入iSCSI伺服器IP，iSCSI服務預設使用3260連接埠，依預設勾選「從父系繼承驗證設定」，
> 確定後即完成新增iSCSI伺服器。
>
> g. 若iSCSI Server及Client設定無誤，「靜態探索」頁籤會自動顯示連接的iSCSI LUN，這時畫面應會出現要求執行「重新掃描介面卡」的告警，點擊後即
> 完成iSCSI儲存區連接，此時下方「路徑」頁籤會有執行接段名稱及其連接之目標，若未顯示代表連接有誤，需再檢查iSCSI Server及Client設定。
>
> h. 完成iSCSI的設定後，就比照新增NFS儲存區方式新增資料存放區，類型選「VMFS」，名稱和裝置選取會自動列出iSCSI連接的LUN，選取後選擇VMFS 6的檔案系統
> 版本，磁碟分割組態採預設值，下一頁核對設定後即完成iSCSI的儲存區新增。
>
> i. 若有多部ESXi主機需掛載相同的iSCSI儲存區，只要完成iSCSI介面卡新增，並於動態探索新增iSCSI伺服器，連線成功即完成儲存區掛載可直接使用。
